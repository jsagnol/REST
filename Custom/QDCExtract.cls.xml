<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Custom.QDCExtract">
<Description>
Version 1.2
TRC76689 06/07/2011
IF			16/07/2014 - TRC177427 - Updated to allow for new payor/plans
</Description>
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60481,52672.888469</TimeCreated>
<Inheritance>right</Inheritance>

<Parameter name="SrcVer">
<Description>
Location and Revision of this file in Perforce (Auto-updating)</Description>
<Default>$Id: //custom_ccrs/au/AUSW/T2016/BASE/cls/Custom/QDCExtract.xml#1 $</Default>
</Parameter>

<Parameter name="BUILD">
<Default>41</Default>
</Parameter>

<Parameter name="SQLDATEFROM">
</Parameter>

<Parameter name="SQLDATETO">
</Parameter>

<Property name="AIHWServiceType">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Parameter name="SQLCODE">
<Default>ID</Default>
</Parameter>

<Property name="AnnualQualityPlan">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CurrentCapacity">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="DaysPerWeek">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Parameter name="SQLDESCRIPTION">
<Default>ID</Default>
</Parameter>

<Property name="EdTrainGroupsCarerFamily">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Parameter name="SQLROWID">
<Default>ID</Default>
</Parameter>

<Property name="Agency">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="FullQuarterOperation">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainGroupsCommunity">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="HoursPerDay">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainGroupsConsumer">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="OutletTypePDSSRR">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainGroupsProf">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainParticipantsCarerFamily">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainParticipantsCommunity">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainParticipantsConsumer">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="EdTrainParticipantsProf">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="GovCategory">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="GovSubCategory">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="MSSHActivitiesProvided">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="NbrServiceUsers">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PaidStaffHrsRefWeek">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ParticipantsCarersFamFrnd">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ParticipantsConsumers">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Plan">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Quarter">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SleepOverNights">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ServiceTypeOutlet">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="StaffEngagedDirect">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="StaffEngagedIndirect">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SupportGroupsCarerFamFrnd">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SupportGroupsConsumers">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SupportGroupsFemale">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="UnPaidStaffHrsRefWeek">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="WaitingListExistence">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="WaitingListNbrPeople">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="WeeksPerQuarter">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Year">
<Type>%String</Type>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Method name="websysSave">
<Description><![CDATA[
Default save method used for updating the database for Components of type Edit.<br>
<br>
The compref is the  component reference which is the string from which we can deduce the instance of<BR>
websysComponent<BR>
websysComponentItem<BR>
id is the id for the instance of class we wish to update.]]></Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>compref:%String,id:%String</FormalSpec>
<Implementation><![CDATA[
 s %code=0
 n class
 s class=%class
 ;
 ; for class starting with web prefix (but not websys), it is likely
 ; that we want to update the core class, not the web class
 i $p(class,".",1)="Custom" s $p(class,".",1)="Custom"
 ;
 #; if class is abstract, quit here, don't instantiate 
 i $$$CLASSabstract($$$MGINFO,%class) $$$GENERATE(" QUIT") QUIT $$$OK
 ;
 ; compile coded has been moved to generated code
 $$$GENERATE(" d ##Class(websys.ComponentXRef).GetSave(compref,id)")
 ;
 q $$$OK
]]></Implementation>
</Method>

<Method name="websysBeforeSave">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[compref:%String,&id:%String]]></FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	n validated
	s validated=1
	q validated
]]></Implementation>
</Method>

<Method name="websysAfterSave">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[compref:%String,&id:%String,new:%Boolean]]></FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	n validated
	s validated=1
	q validated
]]></Implementation>
</Method>

<Method name="websysDelete">
<Description>
Delete an instance - this is provided as a wrapper for %DeleteId functionality.</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>id:%Library.String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0
 n class
 s class=%class
 ;
 ; for class starting with web prefix (but not websys), it is likely
 ; that we want to update the core class, not the web class
 i $p(class,".",1)="web" s $p(class,".",1)="User"
 ;
 #; if class is abstract, quit here, don't instantiate 
 i $$$CLASSabstract($$$MGINFO,%class) $$$GENERATE(" QUIT") QUIT $$$OK
 #;
 $$$GENERATE(" n sc")
 $$$GENERATE(" i id'="""",'##Class(websys.Lock).Lock($lb(id,"""_class_"""),%session.SessionId,$g(%session.Data(""LOGON.USERID"")),.status) d  q $$$OK")
 $$$GENERATE(" . d msg.AddItem(""E"",""LOCKED"",status)")
 $$$GENERATE(" s sc = ##Class("_class_").%DeleteId(id)")
 $$$GENERATE(" i '$$$ISERR(sc) i ##Class(websys.UserDefinedFunctions).Evaluate("""_$s($p(%class,".",1)="web":$p(%class,".",2,99),1:%class)_""",""OnDelete"")")
 $$$GENERATE(" d ##Class(websys.Lock).LockClear($lb(id,"""_class_"""),%session.SessionId)")
 $$$GENERATE(" q sc")
 #;
 QUIT $$$OK
]]></Implementation>
</Method>

<Query name="LookUpQuarter">
<Type>%SQLQuery</Type>
<FormalSpec>val:%String</FormalSpec>
<SqlQuery>SELECT
'January - March' AS Quarter
FROM Custom.QDCExtract
WHERE ((%ALPHAUP 'January - March' %STARTSWITH %ALPHAUP :val) OR (:val IS NULL))
UNION
SELECT
'April - June' AS Quarter
FROM Custom.QDCExtract
WHERE ((%ALPHAUP 'April - June' %STARTSWITH %ALPHAUP :val) OR (:val IS NULL))
UNION
SELECT
'July - September' AS Quarter
FROM Custom.QDCExtract
WHERE ((%ALPHAUP 'July - September' %STARTSWITH %ALPHAUP :val) OR (:val IS NULL))
UNION
SELECT
'October - December' AS Quarter
FROM Custom.QDCExtract
WHERE ((%ALPHAUP 'October - December' %STARTSWITH %ALPHAUP :val) OR (:val IS NULL))</SqlQuery>
</Query>

<Method name="LookUpBrokerByQuarter">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String,itmjsex:%Library.String="",val:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Query name="LookUpYear">
<Type>%SQLQuery</Type>
<FormalSpec>val:%String</FormalSpec>
<SqlQuery>SELECT
'2002' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2002' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2003' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2003' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2004' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2004' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2005' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2005' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2006' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2006' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2007' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2007' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2008' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2008' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2009' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2009' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2010' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2010' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2011' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2011' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2012' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2012' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2013' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2013' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2014' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2014' %STARTSWITH %ALPHAUP :val)
UNION
SELECT
'2015' AS Year FROM Custom.QDCExtract WHERE (%ALPHAUP '2015' %STARTSWITH %ALPHAUP :val)</SqlQuery>
</Query>

<Method name="LookUpBrokerByYear">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String,itmjsex:%Library.String="",val:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Query name="LookUpAgency">
<Type>%Library.SQLQuery</Type>
<FormalSpec>val:%String</FormalSpec>
<SqlQuery><![CDATA[SELECT DISTINCT TRUST_Code, TRUST_RowId, TRUST_Desc
FROM SQLUser.PAC_Trust
WHERE ((%ALPHAUP TRUST_Desc %STARTSWITH %ALPHAUP :val) OR (%ALPHAUP TRUST_Code %STARTSWITH %ALPHAUP :val))
AND (TRUST_DateFrom <= CURRENT_DATE)
AND ((TRUST_DateTo IS NULL) OR (TRUST_DateTo >= CURRENT_DATE))
ORDER BY TRUST_Desc]]></SqlQuery>
<Parameter name="CONTAINID" value="2"/>
<Parameter name="ROWSPEC" value="Code:%String,HIDDEN:%String,Description:%String"/>
</Query>

<Method name="LookUpBrokerByAgency">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String,itmjsex:%Library.String="",val:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Query name="LookUpPlan">
<Description>
      Called by the web broker.
      The main purpose is to convert from code to description dynamically.
      itmjs - javascript function e.g. Location_lookupsel
      itmjsex - extended javascript function</Description>
<Type>%Library.SQLQuery</Type>
<FormalSpec>val:%String</FormalSpec>
<SqlQuery><![CDATA[ SELECT DISTINCT AUXIT_Desc,AUXIT_RowId,AUXIT_Code,AUXIT_InsType_DR->INST_Code,AUXIT_InsType_DR->INST_Code4 FROM SQLUser.ARC_AuxilInsurType
 WHERE ((%ALPHAUP AUXIT_Desc %STARTSWITH %ALPHAUP :val) OR (%ALPHAUP AUXIT_Code %STARTSWITH %ALPHAUP :val))
 AND (AUXIT_InsType_DR->INST_Code IN ('DSD','PDRSS') OR (AUXIT_InsType_DR->INST_Code4 IN ('DSD','PDRSS')))
 ORDER BY AUXIT_InsType_DR->INST_Desc]]></SqlQuery>
<Parameter name="CONTAINID" value="2"/>
<Parameter name="ROWSPEC" value="Plan Description:%String,HIDDEN:%String,Plan Code:%String,Payor:%String,Code4:%String"/>
</Query>

<Method name="LookUpBrokerByPlan">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String,itmjsex:%Library.String="",val:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Query name="LookUpGovCat">
<Type>%Library.SQLQuery</Type>
<FormalSpec>var1:%String</FormalSpec>
<SqlQuery>SELECT GOVCAT_Desc, GOVCAT_RowId, GOVCAT_Code
FROM SQLUser.CT_GovernCateg
WHERE ((%ALPHAUP GOVCAT_Desc %STARTSWITH %ALPHAUP :var) OR (%ALPHAUP GOVCAT_Code %STARTSWITH %ALPHAUP :var))
ORDER BY GOVCAT_Desc</SqlQuery>
<Parameter name="CONTAINID" value="2"/>
<Parameter name="ROWSPEC" value="Description:%String,HIDDEN:%String,Code:%String"/>
</Query>

<Method name="LookUpBrokerGovCat">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String="",itmjsex:%Library.String="",var1:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Query name="LookUpGovSubCat">
<Type>%Library.SQLQuery</Type>
<FormalSpec>var1:%String,var2:%String</FormalSpec>
<SqlQuery><![CDATA[SELECT SUB_Desc, SUB_RowId, SUB_Code
FROM SQLUser.CT_GovernSubcat
WHERE ((%ALPHAUP SUB_Desc %STARTSWITH %ALPHAUP :var) OR (%ALPHAUP SUB_Code %STARTSWITH %ALPHAUP :var))
AND ((SUB_ParRef->GOVCAT_Desc=:var2) OR (:var2 IS NULL))
ORDER BY SUB_Desc]]></SqlQuery>
<Parameter name="CONTAINID" value="2"/>
<Parameter name="ROWSPEC" value="Description:%String,HIDDEN:%String,Code:%String"/>
</Query>

<Method name="LookUpBrokerSubGovCat">
<ClassMethod>1</ClassMethod>
<FormalSpec>itmjs:%Library.String="",itmjsex:%Library.String="",var1:%Library.String="",var2:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Custom.QDCExtractD</DataLocation>
<DefaultData>QDCExtractDefaultData</DefaultData>
<IdLocation>^Custom.QDCExtractD</IdLocation>
<IndexLocation>^Custom.QDCExtractI</IndexLocation>
<StreamLocation>^Custom.QDCExtractS</StreamLocation>
<ExtentSize>100000</ExtentSize>
<Data name="QDCExtractDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>AIHWServiceType</Value>
</Value>
<Value name="3">
<Value>AnnualQualityPlan</Value>
</Value>
<Value name="4">
<Value>CurrentCapacity</Value>
</Value>
<Value name="5">
<Value>DaysPerWeek</Value>
</Value>
<Value name="6">
<Value>EdTrainGroupsCarerFamily</Value>
</Value>
<Value name="7">
<Value>EdTrainGroupsCommunity</Value>
</Value>
<Value name="8">
<Value>EdTrainGroupsConsumer</Value>
</Value>
<Value name="9">
<Value>EdTrainGroupsProf</Value>
</Value>
<Value name="10">
<Value>EdTrainParticipantsCarerFamily</Value>
</Value>
<Value name="11">
<Value>EdTrainParticipantsCommunity</Value>
</Value>
<Value name="12">
<Value>EdTrainParticipantsConsumer</Value>
</Value>
<Value name="13">
<Value>EdTrainParticipantsProf</Value>
</Value>
<Value name="14">
<Value>FullQuarterOperation</Value>
</Value>
<Value name="15">
<Value>HoursPerDay</Value>
</Value>
<Value name="16">
<Value>MSSHActivitiesProvided</Value>
</Value>
<Value name="17">
<Value>NbrServiceUsers</Value>
</Value>
<Value name="18">
<Value>OutletTypePDSSRR</Value>
</Value>
<Value name="19">
<Value>PaidStaffHrsRefWeek</Value>
</Value>
<Value name="20">
<Value>ParticipantsCarersFamFrnd</Value>
</Value>
<Value name="21">
<Value>ParticipantsConsumers</Value>
</Value>
<Value name="22">
<Value>SleepOverNights</Value>
</Value>
<Value name="23">
<Value>StaffEngagedDirect</Value>
</Value>
<Value name="24">
<Value>SupportGroupsCarerFamFrnd</Value>
</Value>
<Value name="25">
<Value>SupportGroupsComsumers</Value>
</Value>
<Value name="26">
<Value>SupportGroupsFemale</Value>
</Value>
<Value name="27">
<Value>UnPaidStaffHrsRefWeek</Value>
</Value>
<Value name="28">
<Value>WaitingListExistence</Value>
</Value>
<Value name="29">
<Value>WaitingListNbrPeople</Value>
</Value>
<Value name="30">
<Value>WeeksPerQAuarter</Value>
</Value>
<Value name="31">
<Value>WeeksPerQuarter</Value>
</Value>
<Value name="32">
<Value>StaffEngagedIndirect</Value>
</Value>
<Value name="33">
<Value>SupportGroupsConsumers</Value>
</Value>
<Value name="34">
<Value>Agency</Value>
</Value>
<Value name="35">
<Value>Quarter</Value>
</Value>
<Value name="36">
<Value>ServiceTypeOutlet</Value>
</Value>
<Value name="37">
<Value>Payor</Value>
</Value>
<Value name="38">
<Value>Year</Value>
</Value>
<Value name="39">
<Value>Plan</Value>
</Value>
<Value name="40">
<Value>GovCategory</Value>
</Value>
<Value name="41">
<Value>GovSubCategory</Value>
</Value>
</Data>
</Storage>
</Class>
</Export>
